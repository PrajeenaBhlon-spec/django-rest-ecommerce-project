{% extends 'product/base.html'%}

{% block title %}Payment{% endblock %}

{% block content %}
  <form method ="POST" id="address-form">
    {% csrf_token %}
    <input name="city" placeholder = "City" type="text">
    <input name="locality" placeholder = "Locality" type="text">
    <input name="tole" placeholder = "Tole" type="text">
    <input name="phone" placeholder = "Phone number" type="number">
    <button type="submit">Submit</button>
  </form>
  <button>Online payment</button>
  <button>Cash on delivery</button>

  <div id="error-message">
  </div>
{% endblock %}

{% block extra_js %}
  <script>
    document.getElementById("address-form").addEventListener("submit" , async function(e){
        e.preventDefault();
        const formData = new FormData(this); 
        const data = {
          city: formData.get("city"),
          locality: formData.get("locality"),
          tole: formData.get("tole"),
          phone: formData.get("phone")
        };

        const response = await authFetch("/product/address/api/", {
          method: "POST",
          body: JSON.stringify(data)
        });

        const result = await response.json();
        if (response.ok){
          window.location.reload();
        }
        else{
          document.getElementById("error-message").textContent = data.message;
        }
      }
      );
  </script>
  {% endblock %}